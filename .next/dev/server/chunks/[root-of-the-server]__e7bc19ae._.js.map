{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/youngjepark/Documents/GitHub/ThangBackend/lib/firebaseAdmin.js"],"sourcesContent":["// lib/firebaseAdmin.js\nimport admin from \"firebase-admin\";\n\nif (!admin.apps.length) {\n  const projectId = process.env.FIREBASE_PROJECT_ID;\n  const clientEmail = process.env.FIREBASE_CLIENT_EMAIL;\n  const privateKey = process.env.FIREBASE_PRIVATE_KEY;\n\n  if (!projectId || !clientEmail || !privateKey) {\n    console.error(\"[FirebaseAdmin] Missing required environment variables:\");\n    console.error(\"  - FIREBASE_PROJECT_ID:\", projectId ? \"✓\" : \"✗\");\n    console.error(\"  - FIREBASE_CLIENT_EMAIL:\", clientEmail ? \"✓\" : \"✗\");\n    console.error(\"  - FIREBASE_PRIVATE_KEY:\", privateKey ? \"✓\" : \"✗\");\n    throw new Error(\"Missing Firebase Admin credentials in environment variables\");\n  }\n\n  try {\n    admin.initializeApp({\n      credential: admin.credential.cert({\n        projectId,\n        clientEmail,\n        privateKey: privateKey.replace(/\\\\n/g, \"\\n\"),\n      }),\n    });\n    console.log(\"[FirebaseAdmin] Successfully initialized\");\n  } catch (error) {\n    console.error(\"[FirebaseAdmin] Initialization error:\", error);\n    throw error;\n  }\n}\n\nexport const adminAuth = admin.auth();\nexport const adminDb = admin.firestore();\n\nexport default admin;\n"],"names":[],"mappings":";;;;;;;;AAAA,uBAAuB;AACvB;;AAEA,IAAI,CAAC,qOAAK,CAAC,IAAI,CAAC,MAAM,EAAE;IACtB,MAAM,YAAY,QAAQ,GAAG,CAAC,mBAAmB;IACjD,MAAM,cAAc,QAAQ,GAAG,CAAC,qBAAqB;IACrD,MAAM,aAAa,QAAQ,GAAG,CAAC,oBAAoB;IAEnD,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,YAAY;QAC7C,QAAQ,KAAK,CAAC;QACd,QAAQ,KAAK,CAAC,4BAA4B,YAAY,MAAM;QAC5D,QAAQ,KAAK,CAAC,8BAA8B,cAAc,MAAM;QAChE,QAAQ,KAAK,CAAC,6BAA6B,aAAa,MAAM;QAC9D,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI;QACF,qOAAK,CAAC,aAAa,CAAC;YAClB,YAAY,qOAAK,CAAC,UAAU,CAAC,IAAI,CAAC;gBAChC;gBACA;gBACA,YAAY,WAAW,OAAO,CAAC,QAAQ;YACzC;QACF;QACA,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yCAAyC;QACvD,MAAM;IACR;AACF;AAEO,MAAM,YAAY,qOAAK,CAAC,IAAI;AAC5B,MAAM,UAAU,qOAAK,CAAC,SAAS;uCAEvB,qOAAK"}},
    {"offset": {"line": 53, "column": 0}, "map": {"version":3,"sources":["file:///Users/youngjepark/Documents/GitHub/ThangBackend/lib/mongodb.js"],"sourcesContent":["import { MongoClient } from \"mongodb\";\n\nif (!process.env.MONGODB_URI) {\n  throw new Error('Invalid/Missing environment variable: \"MONGODB_URI\"');\n}\n\nconst uri = process.env.MONGODB_URI;\nconst options = {\n  maxPoolSize: 10,\n  serverSelectionTimeoutMS: 5000, // Fail after 5 seconds if cannot connect\n  socketTimeoutMS: 45000, // Close sockets after 45 seconds of inactivity\n};\n\nlet client;\nlet clientPromise;\n\nif (process.env.NODE_ENV === \"development\") {\n  // In development mode, use a global variable so that the value\n  // is preserved across module reloads caused by HMR (Hot Module Replacement).\n  if (!global._mongoClientPromise) {\n    client = new MongoClient(uri, options);\n    global._mongoClientPromise = client.connect();\n  }\n  clientPromise = global._mongoClientPromise;\n} else {\n  // In production mode, it's best to not use a global variable.\n  client = new MongoClient(uri, options);\n  clientPromise = client.connect();\n}\n\nexport default clientPromise;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;IAC5B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,UAAU;IACd,aAAa;IACb,0BAA0B;IAC1B,iBAAiB;AACnB;AAEA,IAAI;AACJ,IAAI;AAEJ,wCAA4C;IAC1C,+DAA+D;IAC/D,6EAA6E;IAC7E,IAAI,CAAC,yDAAO,mBAAmB,EAAE;QAC/B,SAAS,IAAI,2MAAW,CAAC,KAAK;QAC9B,yDAAO,mBAAmB,GAAG,OAAO,OAAO;IAC7C;IACA,gBAAgB,yDAAO,mBAAmB;AAC5C;;uCAMe"}},
    {"offset": {"line": 85, "column": 0}, "map": {"version":3,"sources":["file:///Users/youngjepark/Documents/GitHub/ThangBackend/pages/api/party/invite.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from \"next\";\nimport admin from \"@/lib/firebaseAdmin\";\nimport clientPromise from \"@/lib/mongodb\";\nimport { ObjectId } from \"mongodb\";\n\nconst DB_NAME = process.env.NEXT_PUBLIC_DB_NAME || \"game\";\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== \"POST\") {\n    return res.status(405).json({ error: \"Method not allowed\" });\n  }\n\n  try {\n    const { targetUsername } = req.body;\n    if (!targetUsername) {\n      return res.status(400).json({ error: \"Target username is required\" });\n    }\n\n    // 1. Authenticate\n    const authHeader = req.headers.authorization;\n    if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n      return res.status(401).json({ error: \"Missing authorization header\" });\n    }\n    const token = authHeader.split(\"Bearer \")[1];\n    const decodedToken = await admin.auth().verifyIdToken(token);\n    const uid = decodedToken.uid;\n\n    // 2. Connect to DB\n    const client = await clientPromise;\n    const db = client.db(DB_NAME);\n    const users = db.collection(\"users\");\n    const parties = db.collection(\"parties\");\n\n    // 3. Get Current User & Party\n    const currentUser = await users.findOne({ _id: uid });\n    if (!currentUser) return res.status(404).json({ error: \"User not found\" });\n\n    if (!currentUser.partyId) {\n      return res.status(400).json({ error: \"You are not in a party\" });\n    }\n\n    const party = await parties.findOne({\n      _id: new ObjectId(currentUser.partyId),\n    });\n    if (!party) {\n      // Inconsistency fix\n      await users.updateOne({ _id: uid }, { $unset: { partyId: \"\" } });\n      return res.status(404).json({ error: \"Party not found\" });\n    }\n\n    if (party.leaderUid !== uid) {\n      return res\n        .status(403)\n        .json({ error: \"Only the party leader can invite\" });\n    }\n\n    if (party.members.length >= 5) {\n      return res.status(400).json({ error: \"Party is full (max 5 members)\" });\n    }\n\n    // 4. Find Target User\n    const targetUser = await users.findOne({ username: targetUsername });\n    if (!targetUser) {\n      return res.status(404).json({ error: \"User not found\" });\n    }\n\n    if (targetUser.partyId) {\n      return res.status(400).json({ error: \"User is already in a party\" });\n    }\n\n    // Check if already invited\n    const existingInvite = targetUser.partyInvites?.find(\n      (inv: any) => inv.partyId.toString() === party._id.toString()\n    );\n    if (existingInvite) {\n      return res.status(400).json({ error: \"User already invited\" });\n    }\n\n    // 5. Send Invite (Update Target User)\n    const invite = {\n      partyId: party._id,\n      leaderUsername: currentUser.username,\n      invitedAt: new Date(),\n    };\n\n    await users.updateOne(\n      { _id: targetUser._id },\n      { $push: { partyInvites: invite } as any }\n    );\n\n    return res.status(200).json({ message: `Invited ${targetUsername}` });\n  } catch (error: any) {\n    console.error(\"[Party Invite] Error:\", error);\n    return res.status(500).json({ error: \"Internal Server Error\" });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}